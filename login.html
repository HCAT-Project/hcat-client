<!--
  ~ Copyright (C) 2023. HCAT-Project-Team
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program.  If not, see <https://www.gnu.org/licenses/>.
  -->
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta name="description" content="HCAT">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>HCAT - 登录</title>
    <link rel="shortcut icon" href="img/hcat.ico">
    <link rel="stylesheet" href="https://cdn.staticfile.org/mdui/1.0.2/css/mdui.min.css"/>
    <link rel="stylesheet" href="css/main.css"/>
    <script src="https://cdn.staticfile.org/mdui/1.0.2/js/mdui.min.js"></script>
    <script src="js/main.js"></script>
    <script src="js/utils.js"></script>
    <script src="https://cdn.staticfile.org/jquery/3.6.1/jquery.min.js"></script>
    <!--<link href="https://cdn.staticfile.org/twitter-bootstrap/5.2.1/css/bootstrap.min.css" rel="stylesheet">-->
    <!--<script src="https://cdn.staticfile.org/twitter-bootstrap/5.2.1/js/bootstrap.bundle.min.js"></script>-->
</head>
<body class="mdui-theme-primary-indigo mdui-theme-accent-indigo background">
<div class="mdui-appbar mb10" style="box-shadow: 0 0;z-index:10000;position: sticky;">
    <div class="mdui-toolbar mdui-color-indigo-50" id="toolbar">
        <a class="mdui-typo-headline" href="">HCAT</a>
        <a class="mdui-typo-title">登录</a>
    </div>
</div>

<div class="mdui-container-fluid">
    <div class="mdui-row main-area mdui-center" style="width: calc(100% - 28px);">
        <div id="chatting-list" class="card mdui-card" style="height: 518px;padding: 60px;">
            <div class="mdui-text-center mdui-typo-display-3" style="font-size: 36px;">登录HCAT</div>
            <form id="login-form" class="mdui-textfield" style="padding: 16px 20%;">

                <div class="mdui-textfield mdui-textfield-floating-label"><i class="mdui-icon material-icons">account_circle</i><label
                        class="mdui-textfield-label" style="margin-left: 48px;">账号</label>
                    <input id="login_account"
                           required=""
                           class="mdui-textfield-input"
                           style="margin-left: 48px;"
                           type="text"
                           name="uid"
                           onkeyup="value=value.replace(/[\W]/g,'')"/>
                </div>
                <div class="mdui-textfield mdui-textfield-floating-label"><i
                        class="mdui-icon material-icons">lock</i><label class="mdui-textfield-label"
                                                                        style="margin-left: 48px;">密码</label>
                    <input
                            id="login_passwd" required="" class="mdui-textfield-input" style="margin-left: 48px;"
                            type="password" name="password" onkeyup="value=value.replace(/[\W]/g,'')"/>
                </div>
                <br>
                <input id="login-button"
                       class="mdui-btn mdui-btn-block mdui-btn-raised mdui-ripple mdui-color-theme-accent-100"
                       type="submit" value="登录"><br>
                <button onclick="window.location='register.html'"
                        class="mdui-btn mdui-btn-block mdui-btn-raised mdui-ripple mdui-color-theme-accent-100">
                    没有账号？点击注册！
                </button>
            </form>
            <div class="mdui-center mdui-text-center mdui-container">
                <p><strong>通知：由于更新后端，数据已于2023/3/18重置！<br><span id="runtime_span"></span>
                    <script type="text/javascript">function show_runtime() {
                        window.setTimeout("show_runtime()", 1000);
                        let startDate = new Date("10/1/2022 21:00:00");
                        let nowDate = new Date();
                        let elapsedTime = (nowDate.getTime() - startDate.getTime());
                        const DAY_IN_MILLISECOND = 24 * 60 * 60 * 1000;
                        let dayInFloat = elapsedTime / DAY_IN_MILLISECOND;
                        let day = Math.floor(dayInFloat);
                        let hourInFloat = (dayInFloat - day) * 24;
                        let hour = Math.floor(hourInFloat);
                        let minuteInFloat = (hourInFloat - hour) * 60;
                        let minute = Math.floor(minuteInFloat);
                        let second = Math.floor((minuteInFloat - minute) * 60);
                        document.getElementById("runtime_span").innerHTML = "网站已开启测试" + day + "天" + hour + "小时" + minute + "分" + second + "秒";

                    }

                    show_runtime();</script>
                    <br>
                    备案号：<a href="https://beian.miit.gov.cn/" target="_blank">沪B2-20100004</a>
                </strong>
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    function loginHandler() {
        const userID = $("#login_account").val();
        const password = $("#login_passwd").val();
        if (userID === "" || password === "") {
            mdui.snackbar({message: '请填写内容'});
            return;
        }
        $.ajax({
            type: 'post',
            url: apiAddress + "/account/login",
            data: {user_id: userID, password: password},
            dataType: 'text',
            success: function (data) {
                if (statusProcess(data)) {
                    setCookie("user_id", userID, 180);
                    window.location = "index.html";
                }
            }
        });
    }

    if (authenticateToken()) {
        mdui.snackbar({message: '您已登录'});
        window.location = "index.html";
    }
</script>
<script>
    const form = document.getElementById("login-form");

    form.addEventListener("submit", (event) => {
        event.preventDefault();
        loginHandler()
    });
</script>

</body>
</html>